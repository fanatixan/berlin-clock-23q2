language: node_js
services:
  - docker
addons:
  sonarcloud:
    organization: "gotreasa" # the key of the org you chose at step #3
    token:
      secure: "GlWJm4dXf1URX4c9l/7kKJV7kZu/o+nrkCmLnhYhiL5HaapcrP+pc/EiSQZJJIFsSt+hcLSmvIEsvbDextgeVd8T5nWy47uBspNS2F14opC/5Jlxu0lTXYU9yDOKDmYiBTTfqTynBOwvXhWtpnrl6zWVx8a6njWPdJCCZAJqRZmQjARIMFK2WlQK39DfM+mwZv2zOYlnUo/oJK48vfauWpWvN+/fRqm9YCMr8wedMhmWxlAdw0zfkmoThkOXT0+R872ar3CDiRYeDIJ7S52zRFCzdkNBo7Olc7aMRD/k2oEM6NN0hQtWuAzKnk2BTxj+q5Z4yWVpj/oXzfJIL5YhsZSANO63V4tGy0F3DdZJl7XvIkYHMjf4QOb4oCIIegEzYGHMnHpOo4T4AvvK660xsT9JpUYbsUbTDS+zv3bDYE1UHBSFxp2QsUuzkIt0JqmvFb0cGXPVxn41V9XmXhl0YBbtKQq5kgRKXvk28kAYR2HZVTjIQn+hKxd4L0uSJEkY0I9AD0Ojtp2sGgFTKDQJIryIw0Gtw4vmQc7GOaEyyQl0sIpKYppLodkNmgfXg3YvMXTvvA0apuNI/BqLLFqeB3tvW+ASd/KSjp8ayNZS6FTG1I0cel+/W6RVt6vYYLAOpxeRfrBciFGTClxqaysk/6mSEQux/HBcbDiynTu80SY="
stages:
- name: Build
- name: Test
- name: Monitor
jobs:
  include:
  - stage: Build
    env: step=Snyk vulnerability check
    name: Snyk vulnerability check
    script:
      snyk test
  - env: step=Detect secrets in files
    name: Detect secrets in files
    script:
      - npm run detect-secrets $(git --no-pager diff --cached --name-only)
  - env: step=Run commit lint
    name: Run commit lint
    script:
      - commitlint-travis
  - stage: Test
    env: step=Run tests and Sonar Scanner
    name: Run tests and Sonar Scanner
    script:
      - npm test
      - sonar-scanner
  - stage: Monitor
    env: step=Run Snyk Monitor
    name: Run Snyk Monitor
    script:
      snyk monitor
env:
  global:
    # SYNK TOKEN
    secure: "FrmE1sl7NakR2SIv4xkM0tXNiOfrxSztHyYtx7iJ2dA3LCA/w/p4JM+u3T87Vcx3x1DvYc0lnfuCMKvLgej0hXEm17Ev6wOsaNZRVh3EC1dbTL03ev1HZggN8rBYm0e3FpQqD+HR/waF9ebXsOebFdTllPk1wc8lxs9w0hftweJOo1w/c5t95bnOjAavPCsTvCidSNt8PGAdILfeXDZyNrBD4/V/CrPfHiMELHUPleZmQs5B7FK6tL1PRLaRVq7hsCC8hZbq7X7+ZnKHkFyKimrwoCvzMiQQCArQ3CPby2CKOAmE/uLZ6r33M7vOeXRq4e6kYWKoLNXRiUSZRWHNGla7OoEzv92qVVZP8HZJ4SkONI6+atqfrQlIXd+jDdZTwFGxAk8WpvlkPWywXybgnp9ocVJVF9sge4lBY5ABxDCDxxEFHtQX4HOOJ4iPoDCjSa7EjeLozSlhPoJ/zrNq25XxL73MCp84tRtR4tcKMDzGxdvglGYuH0uI31pAV5BwNiZRrOOb6MWKjfnetf/QHZIv3JhbRsltVX1uQyGT7rvA8jFN8P6j4x4FcRw+YxjKMKRkSoD8b/RhnhUblKvHwRMAwShjHZ8Pz2yOPBEkKlkAgNok7NcE4Zlu+OWUAmJ+eZPwfhLMKiTeBVE86HnP/pA85CEYRrHruCIOtYNwMzw="
